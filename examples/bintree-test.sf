include "std.sf";
include "binary_tree.sf";
include "io.sf";

include "random.txt";
include "string.txt";

global readonly auto print_tree = proc<elemType>(tree<elemType> e, proc<nothing, elemType> printElem) return nothing {
	readonly auto print_leaf = proc<elemType>(leaf<elemType> l, proc<nothing, elemType> printElem, int depth) return nothing {
		for(int i = 0; i < depth; i++)
			putChar('\n');

		if(l is empty_leaf<any>)
			println("empty");
		else {
			node<elemType> node = dynamic_cast<node<elemType>>(l);
			printElem(node.elem);
			put_char('\n');
			thisproc<elemType>(node.left, printElem, depth + 1);
			thisproc<elemType>(node.right, printElem, depth + 1);
		}
	};
	print_leaf<elemType>(e.head, printElem, 0);
};

auto tree = new tree<int> {
	compare = proc(int a, int b) return int {
		return a - b;
	};
};

for(int i = 0; i < 100; i++)
	insert<int>(tree, randirange(0, 100));

print_tree<int>(tree, proc(int i) print(itos(i)););